#!/bin/bash

### join_artificial_reads ###

# This script joins the fragmented files generated by
# artfastqgen together into one final output file and
# organises them into fasta format

projectname="benchmark"
# specify length of reads for inDir path:
lengths=( "2000bp30x" )

#make directory hierachy:
homeDir="/home/jamtor"
binDir="$homeDir/local/bin"
projectDir="$homeDir/projects/$projectname"
resultsDir="$projectDir/results"

for length in ${lengths[@]}; do

	echo -e
	echo "Reads of the following length are to be processed: $length"
	
	#input/output directories:
	inDir="$resultsDir/long.artfastqgen.reads/$length/to_combine"
	tempDir="$resultsDir/long.artfastqgen.reads/$length/combined"
	outDir="$resultsDir/artfastqgen.reads"

	mkdir -p $tempDir

	echo -e
	echo "The inDir is:"
	echo $inDir
	echo -e
	echo "The tempDir is:"
	echo $tempDir
	echo -e
	echo "The logDir is:"
	echo $logDir
	
	files=( $(ls $inDir/*.renamed.fastq) )
	
	echo -e
	echo "The files processed are:"
	for file in ${files[@]}; do
		echo -e
		echo $file
		reads=`cat $file`
		echo $reads >> "$tempDir/$length.combined.fastq"
	done;
	
	sed 's/1 /&\n/g' "$tempDir/$length.combined.fastq" > "$tempDir/temp.txt"
	sed 's/ //g' "$tempDir/temp.txt" > "$tempDir/temp2.txt"
	sed 's/@/\n&/g' "$tempDir/temp2.txt" > "$tempDir/temp.txt"
	sed 's/+/\n&/g' "$tempDir/temp.txt" > "$tempDir/temp2.txt"
	sed 's/+/&\n/g' "$tempDir/temp2.txt" > "$tempDir/temp.txt"
	sed '/./,$!d' "$tempDir/temp.txt" > "$tempDir/temp2.txt"
	more "$tempDir/temp2.txt" | perl -ne '$line=$_;if(length($line)>121){@array=$line=~/\w{1,121}/g;print(join("\n", @array));print "\n"}else{print $line}' > "$outDir/$length.fastq"
	#rm $outDir/temp*
done;